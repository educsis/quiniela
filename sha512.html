<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head><meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type"><title>Paj's Home: Cryptography: JavaScript MD5: Scripts: sha512.js</title><meta content="java, script, javascript, MD5, MD4, SHA, SHA-1, secure, hash, algorithm, digital, signature, password, protection" name="keywords"><meta content="Download the scripts, see information about their history and future plans, and links to other resources." name="description"><link href="../../styles/common.css" rel="stylesheet"><link href="../../styles/blue-white.css" rel="stylesheet"></head><body><ul id="nav"><li><a href="/index.html">Paj's Home</a>:
                &nbsp;
                <ul><li><a href="/aboutme/index.html">About Me</a><br></li><li><a href="/crypt/index.html">Cryptography</a><br></li><li><a href="/security/index.html">Security</a><br></li><li><a href="/progs/index.html">Programming</a><br></li><li><a href="/web/index.html">Web Applications</a><br></li></ul></li><li><a href="/crypt/index.html">Cryptography</a>:
                &nbsp;
                <ul><li><a href="/crypt/rsa/index.html">RSA</a><br></li><li><a href="/crypt/md5/index.html">JavaScript MD5</a><br></li><li><a href="/crypt/vigenere.html">Vigenere Cipher</a><br></li><li><a href="/crypt/wordpat.html">Word Patterns</a><br></li></ul></li><li><a href="/crypt/md5/index.html">JavaScript MD5</a>:
                &nbsp;
                <ul><li><a href="/crypt/md5/scripts.html">Scripts</a><br></li><li><a href="/crypt/md5/instructions.html">Instructions</a><br></li><li><a href="/crypt/md5/auth.html">Protecting Passwords</a><br></li><li><a href="/crypt/md5/advancedauth.html">Advanced Authentication</a><br></li><li><a href="/crypt/md5/uses.html">Other Uses</a><br></li><li><a href="/crypt/md5/browsertest.html">Browser Test</a><br></li></ul></li><li><a href="/crypt/md5/scripts.html">Scripts</a>:
                &nbsp;
                <ul><li><a href="/crypt/md5/md5.html">md5.js</a><br></li><li><a href="/crypt/md5/ripemd160.html">ripemd160.js</a><br></li><li><a href="/crypt/md5/sha1.html">sha1.js</a><br></li><li><a href="/crypt/md5/sha256.html">sha256.js</a><br></li><li><a href="/crypt/md5/sha512.html">sha512.js</a><br></li></ul></li><li><a href="/crypt/md5/sha512.html">sha512.js</a>
                &nbsp;
                </li></ul><script type="text/javascript">
    if (/MSIE (\d+\.\d+);/.test(navigator.userAgent)){         
        if(new Number(RegExp.$1) < 8) {
            var sfEls = document.getElementById("nav").getElementsByTagName("LI");
            for(var i=0; i < sfEls.length; i++) {
                sfEls[i].onmouseover=function() {
                    this.className+=" sfhover";
                }
                sfEls[i].onmouseout=function() {
                    this.className=this.className.replace(new RegExp(" sfhover"), "");
                }
            }
    
            var nav = document.getElementById("nav");
            for(var tnode = nav.firstChild; tnode; tnode = tnode.nextSibling)
            {
                popup = tnode.getElementsByTagName("UL");
                if(popup.length == 0) break;
                popup = popup[0];
                var posX = 0;
                var posY = 0;
                var node = tnode;
                while(node != null){
                    posX += node.offsetLeft;
                    posY += node.offsetTop;
                    node = node.offsetParent;
                }
                popup.style.top = posY + 18;
                popup.style.left = posX - 40;
            }
        }
    }
    </script><div class="clearit"></div><table style="width:100%; border-collapse: collapse"><tr><td style="width:170px"><a href="../../site/logos.html"><img src="../../logos/crypto.jpg" alt="" height="213" style="border:none" width="160"></a><p style="text-align:center"></p><p style="text-align:center"><script type="text/javascript">
                        google_ad_client = "pub-3545889579815990";
                        google_ad_width = 120;
                        google_ad_height = 240;
                        google_ad_format = "120x240_as";
                        google_ad_channel ="";
                        </script><script src="http://pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript"></script></p></td><td><div style="text-align:center"><img src="sha512_js.png" alt="sha512.js" height="68" width="213"></div>
<div class="source"><pre><span class="cm">/*</span>
<span class="cm"> * A JavaScript implementation of the Secure Hash Algorithm, SHA-512, as defined</span>
<span class="cm"> * in FIPS 180-2</span>
<span class="cm"> * Version 2.2 Copyright Anonymous Contributor, Paul Johnston 2000 - 2009.</span>
<span class="cm"> * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet</span>
<span class="cm"> * Distributed under the BSD License</span>
<span class="cm"> * See http://pajhome.org.uk/crypt/md5 for details.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Configurable variables. You may need to tweak these to be compatible with</span>
<span class="cm"> * the server-side, but the defaults work in most cases.</span>
<span class="cm"> */</span>
<span class="kd">var</span> <span class="nx">hexcase</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="cm">/* hex output format. 0 - lowercase; 1 - uppercase        */</span>
<span class="kd">var</span> <span class="nx">b64pad</span>  <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="cm">/* base-64 pad character. &quot;=&quot; for strict RFC compliance   */</span>

<span class="cm">/*</span>
<span class="cm"> * These are the functions you&#39;ll usually want to call</span>
<span class="cm"> * They take string arguments and return either hex or base-64 encoded strings</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">hex_sha512</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>    <span class="p">{</span> <span class="k">return</span> <span class="nx">rstr2hex</span><span class="p">(</span><span class="nx">rstr_sha512</span><span class="p">(</span><span class="nx">str2rstr_utf8</span><span class="p">(</span><span class="nx">s</span><span class="p">)));</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nx">b64_sha512</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>    <span class="p">{</span> <span class="k">return</span> <span class="nx">rstr2b64</span><span class="p">(</span><span class="nx">rstr_sha512</span><span class="p">(</span><span class="nx">str2rstr_utf8</span><span class="p">(</span><span class="nx">s</span><span class="p">)));</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nx">any_sha512</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">rstr2any</span><span class="p">(</span><span class="nx">rstr_sha512</span><span class="p">(</span><span class="nx">str2rstr_utf8</span><span class="p">(</span><span class="nx">s</span><span class="p">)),</span> <span class="nx">e</span><span class="p">);}</span>
<span class="kd">function</span> <span class="nx">hex_hmac_sha512</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">d</span><span class="p">)</span>
  <span class="p">{</span> <span class="k">return</span> <span class="nx">rstr2hex</span><span class="p">(</span><span class="nx">rstr_hmac_sha512</span><span class="p">(</span><span class="nx">str2rstr_utf8</span><span class="p">(</span><span class="nx">k</span><span class="p">),</span> <span class="nx">str2rstr_utf8</span><span class="p">(</span><span class="nx">d</span><span class="p">)));</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nx">b64_hmac_sha512</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">d</span><span class="p">)</span>
  <span class="p">{</span> <span class="k">return</span> <span class="nx">rstr2b64</span><span class="p">(</span><span class="nx">rstr_hmac_sha512</span><span class="p">(</span><span class="nx">str2rstr_utf8</span><span class="p">(</span><span class="nx">k</span><span class="p">),</span> <span class="nx">str2rstr_utf8</span><span class="p">(</span><span class="nx">d</span><span class="p">)));</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nx">any_hmac_sha512</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span>
  <span class="p">{</span> <span class="k">return</span> <span class="nx">rstr2any</span><span class="p">(</span><span class="nx">rstr_hmac_sha512</span><span class="p">(</span><span class="nx">str2rstr_utf8</span><span class="p">(</span><span class="nx">k</span><span class="p">),</span> <span class="nx">str2rstr_utf8</span><span class="p">(</span><span class="nx">d</span><span class="p">)),</span> <span class="nx">e</span><span class="p">);}</span>

<span class="cm">/*</span>
<span class="cm"> * Perform a simple self-test to see if the VM is working</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">sha512_vm_test</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="nx">hex_sha512</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">==</span>
    <span class="s2">&quot;ddaf35a193617abacc417349ae20413112e6fa4e89a97ea20a9eeee64b55d39a&quot;</span> <span class="o">+</span>
    <span class="s2">&quot;2192992a274fc1a836ba3c23a3feebbd454d4423643ce80e2a9ac94fa54ca49f&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Calculate the SHA-512 of a raw string</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">rstr_sha512</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="nx">binb2rstr</span><span class="p">(</span><span class="nx">binb_sha512</span><span class="p">(</span><span class="nx">rstr2binb</span><span class="p">(</span><span class="nx">s</span><span class="p">),</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">8</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Calculate the HMAC-SHA-512 of a key and some data (raw strings)</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">rstr_hmac_sha512</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kd">var</span> <span class="nx">bkey</span> <span class="o">=</span> <span class="nx">rstr2binb</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">bkey</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">32</span><span class="p">)</span> <span class="nx">bkey</span> <span class="o">=</span> <span class="nx">binb_sha512</span><span class="p">(</span><span class="nx">bkey</span><span class="p">,</span> <span class="nx">key</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">8</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">ipad</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="nx">opad</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nx">ipad</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">bkey</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">^</span> <span class="mh">0x36363636</span><span class="p">;</span>
    <span class="nx">opad</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">bkey</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">^</span> <span class="mh">0x5C5C5C5C</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nx">binb_sha512</span><span class="p">(</span><span class="nx">ipad</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">rstr2binb</span><span class="p">(</span><span class="nx">data</span><span class="p">)),</span> <span class="mi">1024</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">8</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">binb2rstr</span><span class="p">(</span><span class="nx">binb_sha512</span><span class="p">(</span><span class="nx">opad</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">hash</span><span class="p">),</span> <span class="mi">1024</span> <span class="o">+</span> <span class="mi">512</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Convert a raw string to a hex string</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">rstr2hex</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span> <span class="nx">hexcase</span> <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">hexcase</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">hex_tab</span> <span class="o">=</span> <span class="nx">hexcase</span> <span class="o">?</span> <span class="s2">&quot;0123456789ABCDEF&quot;</span> <span class="o">:</span> <span class="s2">&quot;0123456789abcdef&quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">x</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">input</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
    <span class="nx">output</span> <span class="o">+=</span> <span class="nx">hex_tab</span><span class="p">.</span><span class="nx">charAt</span><span class="p">((</span><span class="nx">x</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span>
           <span class="o">+</span>  <span class="nx">hex_tab</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span> <span class="nx">x</span>        <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Convert a raw string to a base-64 string</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">rstr2b64</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span> <span class="nx">b64pad</span> <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">b64pad</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span> <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">tab</span> <span class="o">=</span> <span class="s2">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">triplet</span> <span class="o">=</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span>
                <span class="o">|</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nx">len</span> <span class="o">?</span> <span class="nx">input</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span>
                <span class="o">|</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">&lt;</span> <span class="nx">len</span> <span class="o">?</span> <span class="nx">input</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>      <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="nx">j</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">&gt;</span> <span class="nx">input</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="nx">output</span> <span class="o">+=</span> <span class="nx">b64pad</span><span class="p">;</span>
      <span class="k">else</span> <span class="nx">output</span> <span class="o">+=</span> <span class="nx">tab</span><span class="p">.</span><span class="nx">charAt</span><span class="p">((</span><span class="nx">triplet</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="nx">j</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Convert a raw string to an arbitrary string encoding</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">rstr2any</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kd">var</span> <span class="nx">divisor</span> <span class="o">=</span> <span class="nx">encoding</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">q</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">quotient</span><span class="p">;</span>

  <span class="cm">/* Convert to an array of 16-bit big-endian values, forming the dividend */</span>
  <span class="kd">var</span> <span class="nx">dividend</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">));</span>
  <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">dividend</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nx">dividend</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="nx">input</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="cm">/*</span>
<span class="cm">   * Repeatedly perform a long division. The binary array forms the dividend,</span>
<span class="cm">   * the length of the encoding is the divisor. Once computed, the quotient</span>
<span class="cm">   * forms the dividend for the next step. All remainders are stored for later</span>
<span class="cm">   * use.</span>
<span class="cm">   */</span>
  <span class="kd">var</span> <span class="nx">full_length</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">/</span>
                                    <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">encoding</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">/</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)));</span>
  <span class="kd">var</span> <span class="nx">remainders</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">full_length</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">full_length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nx">quotient</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">();</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">dividend</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="nx">dividend</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="nx">q</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">x</span> <span class="o">/</span> <span class="nx">divisor</span><span class="p">);</span>
      <span class="nx">x</span> <span class="o">-=</span> <span class="nx">q</span> <span class="o">*</span> <span class="nx">divisor</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">quotient</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">q</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nx">quotient</span><span class="p">[</span><span class="nx">quotient</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">q</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">remainders</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="nx">dividend</span> <span class="o">=</span> <span class="nx">quotient</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/* Convert the remainders to the output string */</span>
  <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">remainders</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span>
    <span class="nx">output</span> <span class="o">+=</span> <span class="nx">encoding</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">remainders</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>

  <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode a string as utf-8.</span>
<span class="cm"> * For efficiency, this assumes the input is valid utf-16.</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">str2rstr_utf8</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">;</span>

  <span class="k">while</span><span class="p">(</span><span class="o">++</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">input</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="cm">/* Decode utf-16 surrogate pairs */</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
    <span class="nx">y</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="nx">input</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">input</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="mh">0xD800</span> <span class="o">&lt;=</span> <span class="nx">x</span> <span class="o">&amp;&amp;</span> <span class="nx">x</span> <span class="o">&lt;=</span> <span class="mh">0xDBFF</span> <span class="o">&amp;&amp;</span> <span class="mh">0xDC00</span> <span class="o">&lt;=</span> <span class="nx">y</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span> <span class="o">&lt;=</span> <span class="mh">0xDFFF</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="mh">0x10000</span> <span class="o">+</span> <span class="p">((</span><span class="nx">x</span> <span class="o">&amp;</span> <span class="mh">0x03FF</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y</span> <span class="o">&amp;</span> <span class="mh">0x03FF</span><span class="p">);</span>
      <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* Encode output as utf-8 */</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="mh">0x7F</span><span class="p">)</span>
      <span class="nx">output</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="mh">0x7FF</span><span class="p">)</span>
      <span class="nx">output</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mh">0xC0</span> <span class="o">|</span> <span class="p">((</span><span class="nx">x</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1F</span><span class="p">),</span>
                                    <span class="mh">0x80</span> <span class="o">|</span> <span class="p">(</span> <span class="nx">x</span>         <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">));</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="mh">0xFFFF</span><span class="p">)</span>
      <span class="nx">output</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mh">0xE0</span> <span class="o">|</span> <span class="p">((</span><span class="nx">x</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">),</span>
                                    <span class="mh">0x80</span> <span class="o">|</span> <span class="p">((</span><span class="nx">x</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">),</span>
                                    <span class="mh">0x80</span> <span class="o">|</span> <span class="p">(</span> <span class="nx">x</span>         <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">));</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">x</span> <span class="o">&lt;=</span> <span class="mh">0x1FFFFF</span><span class="p">)</span>
      <span class="nx">output</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="mh">0xF0</span> <span class="o">|</span> <span class="p">((</span><span class="nx">x</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">),</span>
                                    <span class="mh">0x80</span> <span class="o">|</span> <span class="p">((</span><span class="nx">x</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">),</span>
                                    <span class="mh">0x80</span> <span class="o">|</span> <span class="p">((</span><span class="nx">x</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">),</span>
                                    <span class="mh">0x80</span> <span class="o">|</span> <span class="p">(</span> <span class="nx">x</span>         <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode a string as utf-16</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">str2rstr_utf16le</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">input</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
    <span class="nx">output</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span> <span class="nx">input</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>        <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span>
                                  <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">str2rstr_utf16be</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">input</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
    <span class="nx">output</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">((</span><span class="nx">input</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span>
                                   <span class="nx">input</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>        <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Convert a raw string to an array of big-endian words</span>
<span class="cm"> * Characters &gt;255 have their high-byte silently ignored.</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">rstr2binb</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">output</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
    <span class="nx">output</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">input</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">8</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">)</span>
    <span class="nx">output</span><span class="p">[</span><span class="nx">i</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">]</span> <span class="o">|=</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">24</span> <span class="o">-</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">32</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Convert an array of big-endian words to a string</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">binb2rstr</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">input</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">32</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">)</span>
    <span class="nx">output</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">((</span><span class="nx">input</span><span class="p">[</span><span class="nx">i</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">]</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="mi">24</span> <span class="o">-</span> <span class="nx">i</span> <span class="o">%</span> <span class="mi">32</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Calculate the SHA-512 of an array of big-endian dwords, and a bit length</span>
<span class="cm"> */</span>
<span class="kd">var</span> <span class="nx">sha512_k</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">binb_sha512</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">len</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">sha512_k</span> <span class="o">==</span> <span class="kc">undefined</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">//SHA512 constants</span>
    <span class="nx">sha512_k</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x428a2f98</span><span class="p">,</span> <span class="o">-</span><span class="mi">685199838</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x71374491</span><span class="p">,</span> <span class="mh">0x23ef65cd</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1245643825</span><span class="p">,</span> <span class="o">-</span><span class="mi">330482897</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">373957723</span><span class="p">,</span> <span class="o">-</span><span class="mi">2121671748</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x3956c25b</span><span class="p">,</span> <span class="o">-</span><span class="mi">213338824</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x59f111f1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1241133031</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1841331548</span><span class="p">,</span> <span class="o">-</span><span class="mi">1357295717</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1424204075</span><span class="p">,</span> <span class="o">-</span><span class="mi">630357736</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">670586216</span><span class="p">,</span> <span class="o">-</span><span class="mi">1560083902</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x12835b01</span><span class="p">,</span> <span class="mh">0x45706fbe</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x243185be</span><span class="p">,</span> <span class="mh">0x4ee4b28c</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x550c7dc3</span><span class="p">,</span> <span class="o">-</span><span class="mi">704662302</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x72be5d74</span><span class="p">,</span> <span class="o">-</span><span class="mi">226784913</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">2132889090</span><span class="p">,</span> <span class="mh">0x3b1696b1</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1680079193</span><span class="p">,</span> <span class="mh">0x25c71235</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1046744716</span><span class="p">,</span> <span class="o">-</span><span class="mi">815192428</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">459576895</span><span class="p">,</span> <span class="o">-</span><span class="mi">1628353838</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">272742522</span><span class="p">,</span> <span class="mh">0x384f25e3</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0xfc19dc6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1953704523</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x240ca1cc</span><span class="p">,</span> <span class="mh">0x77ac9c65</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x2de92c6f</span><span class="p">,</span> <span class="mh">0x592b0275</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x4a7484aa</span><span class="p">,</span> <span class="mh">0x6ea6e483</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x5cb0a9dc</span><span class="p">,</span> <span class="o">-</span><span class="mi">1119749164</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x76f988da</span><span class="p">,</span> <span class="o">-</span><span class="mi">2096016459</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1740746414</span><span class="p">,</span> <span class="o">-</span><span class="mi">295247957</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1473132947</span><span class="p">,</span> <span class="mh">0x2db43210</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1341970488</span><span class="p">,</span> <span class="o">-</span><span class="mi">1728372417</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1084653625</span><span class="p">,</span> <span class="o">-</span><span class="mi">1091629340</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">958395405</span><span class="p">,</span> <span class="mh">0x3da88fc2</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">710438585</span><span class="p">,</span> <span class="o">-</span><span class="mi">1828018395</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x6ca6351</span><span class="p">,</span> <span class="o">-</span><span class="mi">536640913</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x14292967</span><span class="p">,</span> <span class="mh">0xa0e6e70</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x27b70a85</span><span class="p">,</span> <span class="mh">0x46d22ffc</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x2e1b2138</span><span class="p">,</span> <span class="mh">0x5c26c926</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x4d2c6dfc</span><span class="p">,</span> <span class="mh">0x5ac42aed</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x53380d13</span><span class="p">,</span> <span class="o">-</span><span class="mi">1651133473</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x650a7354</span><span class="p">,</span> <span class="o">-</span><span class="mi">1951439906</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x766a0abb</span><span class="p">,</span> <span class="mh">0x3c77b2a8</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">2117940946</span><span class="p">,</span> <span class="mh">0x47edaee6</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1838011259</span><span class="p">,</span> <span class="mh">0x1482353b</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1564481375</span><span class="p">,</span> <span class="mh">0x4cf10364</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1474664885</span><span class="p">,</span> <span class="o">-</span><span class="mi">1136513023</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1035236496</span><span class="p">,</span> <span class="o">-</span><span class="mi">789014639</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">949202525</span><span class="p">,</span> <span class="mh">0x654be30</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">778901479</span><span class="p">,</span> <span class="o">-</span><span class="mi">688958952</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">694614492</span><span class="p">,</span> <span class="mh">0x5565a910</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">200395387</span><span class="p">,</span> <span class="mh">0x5771202a</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x106aa070</span><span class="p">,</span> <span class="mh">0x32bbd1b8</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x19a4c116</span><span class="p">,</span> <span class="o">-</span><span class="mi">1194143544</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x1e376c08</span><span class="p">,</span> <span class="mh">0x5141ab53</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x2748774c</span><span class="p">,</span> <span class="o">-</span><span class="mi">544281703</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x34b0bcb5</span><span class="p">,</span> <span class="o">-</span><span class="mi">509917016</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x391c0cb3</span><span class="p">,</span> <span class="o">-</span><span class="mi">976659869</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x4ed8aa4a</span><span class="p">,</span> <span class="o">-</span><span class="mi">482243893</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x5b9cca4f</span><span class="p">,</span> <span class="mh">0x7763e373</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x682e6ff3</span><span class="p">,</span> <span class="o">-</span><span class="mi">692930397</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x748f82ee</span><span class="p">,</span> <span class="mh">0x5defb2fc</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x78a5636f</span><span class="p">,</span> <span class="mh">0x43172f60</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">2067236844</span><span class="p">,</span> <span class="o">-</span><span class="mi">1578062990</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1933114872</span><span class="p">,</span> <span class="mh">0x1a6439ec</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1866530822</span><span class="p">,</span> <span class="mh">0x23631e28</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1538233109</span><span class="p">,</span> <span class="o">-</span><span class="mi">561857047</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1090935817</span><span class="p">,</span> <span class="o">-</span><span class="mi">1295615723</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">965641998</span><span class="p">,</span> <span class="o">-</span><span class="mi">479046869</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">903397682</span><span class="p">,</span> <span class="o">-</span><span class="mi">366583396</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">779700025</span><span class="p">,</span> <span class="mh">0x21c0c207</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">354779690</span><span class="p">,</span> <span class="o">-</span><span class="mi">840897762</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">176337025</span><span class="p">,</span> <span class="o">-</span><span class="mi">294727304</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x6f067aa</span><span class="p">,</span> <span class="mh">0x72176fba</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0xa637dc5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1563912026</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x113f9804</span><span class="p">,</span> <span class="o">-</span><span class="mi">1090974290</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x1b710b35</span><span class="p">,</span> <span class="mh">0x131c471b</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x28db77f5</span><span class="p">,</span> <span class="mh">0x23047d84</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x32caab7b</span><span class="p">,</span> <span class="mh">0x40c72493</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x3c9ebe0a</span><span class="p">,</span> <span class="mh">0x15c9bebc</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x431d67c4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1676669620</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x4cc5d4be</span><span class="p">,</span> <span class="o">-</span><span class="mi">885112138</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x597f299c</span><span class="p">,</span> <span class="o">-</span><span class="mi">60457430</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x5fcb6fab</span><span class="p">,</span> <span class="mh">0x3ad6faec</span><span class="p">),</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x6c44198c</span><span class="p">,</span> <span class="mh">0x4a475817</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="c1">//Initial hash values</span>
  <span class="kd">var</span> <span class="nx">H</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x6a09e667</span><span class="p">,</span> <span class="o">-</span><span class="mi">205731576</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1150833019</span><span class="p">,</span> <span class="o">-</span><span class="mi">2067093701</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x3c6ef372</span><span class="p">,</span> <span class="o">-</span><span class="mi">23791573</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1521486534</span><span class="p">,</span> <span class="mh">0x5f1d36f1</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x510e527f</span><span class="p">,</span> <span class="o">-</span><span class="mi">1377402159</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="o">-</span><span class="mi">1694144372</span><span class="p">,</span> <span class="mh">0x2b3e6c1f</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x1f83d9ab</span><span class="p">,</span> <span class="o">-</span><span class="mi">79577749</span><span class="p">),</span>
<span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mh">0x5be0cd19</span><span class="p">,</span> <span class="mh">0x137e2179</span><span class="p">));</span>

  <span class="kd">var</span> <span class="nx">T1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="nx">T2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="nx">e</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="nx">g</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="nx">h</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
    <span class="c1">//Temporary variables not specified by the document</span>
    <span class="nx">s0</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="nx">s1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="nx">Ch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="nx">Maj</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="nx">r1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="nx">r2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="nx">r3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">W</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">80</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
    <span class="nx">W</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

  <span class="c1">// append padding to the source string. The format is described in the FIPS.</span>
  <span class="nx">x</span><span class="p">[</span><span class="nx">len</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">]</span> <span class="o">|=</span> <span class="mh">0x80</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">24</span> <span class="o">-</span> <span class="p">(</span><span class="nx">len</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">));</span>
  <span class="nx">x</span><span class="p">[((</span><span class="nx">len</span> <span class="o">+</span> <span class="mi">128</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">)</span><span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">31</span><span class="p">]</span> <span class="o">=</span> <span class="nx">len</span><span class="p">;</span>

  <span class="k">for</span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">x</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">+=</span><span class="mi">32</span><span class="p">)</span> <span class="c1">//32 dwords is the block size</span>
  <span class="p">{</span>
    <span class="nx">int64copy</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="nx">int64copy</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="nx">int64copy</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">H</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="nx">int64copy</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">H</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
    <span class="nx">int64copy</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">H</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
    <span class="nx">int64copy</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">H</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span>
    <span class="nx">int64copy</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span> <span class="nx">H</span><span class="p">[</span><span class="mi">6</span><span class="p">]);</span>
    <span class="nx">int64copy</span><span class="p">(</span><span class="nx">h</span><span class="p">,</span> <span class="nx">H</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>

    <span class="k">for</span><span class="p">(</span><span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">j</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">W</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">x</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nx">j</span><span class="p">];</span>
        <span class="nx">W</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">l</span> <span class="o">=</span> <span class="nx">x</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nx">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="nx">j</span><span class="o">=</span><span class="mi">16</span><span class="p">;</span> <span class="nx">j</span><span class="o">&lt;</span><span class="mi">80</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">//sigma1</span>
      <span class="nx">int64rrot</span><span class="p">(</span><span class="nx">r1</span><span class="p">,</span> <span class="nx">W</span><span class="p">[</span><span class="nx">j</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="mi">19</span><span class="p">);</span>
      <span class="nx">int64revrrot</span><span class="p">(</span><span class="nx">r2</span><span class="p">,</span> <span class="nx">W</span><span class="p">[</span><span class="nx">j</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="mi">29</span><span class="p">);</span>
      <span class="nx">int64shr</span><span class="p">(</span><span class="nx">r3</span><span class="p">,</span> <span class="nx">W</span><span class="p">[</span><span class="nx">j</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="mi">6</span><span class="p">);</span>
      <span class="nx">s1</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">l</span> <span class="o">^</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">l</span> <span class="o">^</span> <span class="nx">r3</span><span class="p">.</span><span class="nx">l</span><span class="p">;</span>
      <span class="nx">s1</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">h</span> <span class="o">^</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">h</span> <span class="o">^</span> <span class="nx">r3</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>
      <span class="c1">//sigma0</span>
      <span class="nx">int64rrot</span><span class="p">(</span><span class="nx">r1</span><span class="p">,</span> <span class="nx">W</span><span class="p">[</span><span class="nx">j</span><span class="o">-</span><span class="mi">15</span><span class="p">],</span> <span class="mi">1</span><span class="p">);</span>
      <span class="nx">int64rrot</span><span class="p">(</span><span class="nx">r2</span><span class="p">,</span> <span class="nx">W</span><span class="p">[</span><span class="nx">j</span><span class="o">-</span><span class="mi">15</span><span class="p">],</span> <span class="mi">8</span><span class="p">);</span>
      <span class="nx">int64shr</span><span class="p">(</span><span class="nx">r3</span><span class="p">,</span> <span class="nx">W</span><span class="p">[</span><span class="nx">j</span><span class="o">-</span><span class="mi">15</span><span class="p">],</span> <span class="mi">7</span><span class="p">);</span>
      <span class="nx">s0</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">l</span> <span class="o">^</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">l</span> <span class="o">^</span> <span class="nx">r3</span><span class="p">.</span><span class="nx">l</span><span class="p">;</span>
      <span class="nx">s0</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">h</span> <span class="o">^</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">h</span> <span class="o">^</span> <span class="nx">r3</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>

      <span class="nx">int64add4</span><span class="p">(</span><span class="nx">W</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">s1</span><span class="p">,</span> <span class="nx">W</span><span class="p">[</span><span class="nx">j</span><span class="o">-</span><span class="mi">7</span><span class="p">],</span> <span class="nx">s0</span><span class="p">,</span> <span class="nx">W</span><span class="p">[</span><span class="nx">j</span><span class="o">-</span><span class="mi">16</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">//Ch</span>
      <span class="nx">Ch</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">l</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="o">~</span><span class="nx">e</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="nx">g</span><span class="p">.</span><span class="nx">l</span><span class="p">);</span>
      <span class="nx">Ch</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="nx">f</span><span class="p">.</span><span class="nx">h</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="o">~</span><span class="nx">e</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="nx">g</span><span class="p">.</span><span class="nx">h</span><span class="p">);</span>

      <span class="c1">//Sigma1</span>
      <span class="nx">int64rrot</span><span class="p">(</span><span class="nx">r1</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="mi">14</span><span class="p">);</span>
      <span class="nx">int64rrot</span><span class="p">(</span><span class="nx">r2</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
      <span class="nx">int64revrrot</span><span class="p">(</span><span class="nx">r3</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
      <span class="nx">s1</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">l</span> <span class="o">^</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">l</span> <span class="o">^</span> <span class="nx">r3</span><span class="p">.</span><span class="nx">l</span><span class="p">;</span>
      <span class="nx">s1</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">h</span> <span class="o">^</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">h</span> <span class="o">^</span> <span class="nx">r3</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>

      <span class="c1">//Sigma0</span>
      <span class="nx">int64rrot</span><span class="p">(</span><span class="nx">r1</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="mi">28</span><span class="p">);</span>
      <span class="nx">int64revrrot</span><span class="p">(</span><span class="nx">r2</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
      <span class="nx">int64revrrot</span><span class="p">(</span><span class="nx">r3</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
      <span class="nx">s0</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">l</span> <span class="o">^</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">l</span> <span class="o">^</span> <span class="nx">r3</span><span class="p">.</span><span class="nx">l</span><span class="p">;</span>
      <span class="nx">s0</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">r1</span><span class="p">.</span><span class="nx">h</span> <span class="o">^</span> <span class="nx">r2</span><span class="p">.</span><span class="nx">h</span> <span class="o">^</span> <span class="nx">r3</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>

      <span class="c1">//Maj</span>
      <span class="nx">Maj</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">l</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">l</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">l</span><span class="p">);</span>
      <span class="nx">Maj</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">h</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">h</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">h</span><span class="p">);</span>

      <span class="nx">int64add5</span><span class="p">(</span><span class="nx">T1</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s1</span><span class="p">,</span> <span class="nx">Ch</span><span class="p">,</span> <span class="nx">sha512_k</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">W</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span>
      <span class="nx">int64add</span><span class="p">(</span><span class="nx">T2</span><span class="p">,</span> <span class="nx">s0</span><span class="p">,</span> <span class="nx">Maj</span><span class="p">);</span>

      <span class="nx">int64copy</span><span class="p">(</span><span class="nx">h</span><span class="p">,</span> <span class="nx">g</span><span class="p">);</span>
      <span class="nx">int64copy</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span> <span class="nx">f</span><span class="p">);</span>
      <span class="nx">int64copy</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
      <span class="nx">int64add</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">T1</span><span class="p">);</span>
      <span class="nx">int64copy</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
      <span class="nx">int64copy</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">b</span><span class="p">);</span>
      <span class="nx">int64copy</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">);</span>
      <span class="nx">int64add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">T1</span><span class="p">,</span> <span class="nx">T2</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">int64add</span><span class="p">(</span><span class="nx">H</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">H</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">a</span><span class="p">);</span>
    <span class="nx">int64add</span><span class="p">(</span><span class="nx">H</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">H</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">b</span><span class="p">);</span>
    <span class="nx">int64add</span><span class="p">(</span><span class="nx">H</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">H</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">c</span><span class="p">);</span>
    <span class="nx">int64add</span><span class="p">(</span><span class="nx">H</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="nx">H</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="nx">d</span><span class="p">);</span>
    <span class="nx">int64add</span><span class="p">(</span><span class="nx">H</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="nx">H</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="nx">e</span><span class="p">);</span>
    <span class="nx">int64add</span><span class="p">(</span><span class="nx">H</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="nx">H</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="nx">f</span><span class="p">);</span>
    <span class="nx">int64add</span><span class="p">(</span><span class="nx">H</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="nx">H</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="nx">g</span><span class="p">);</span>
    <span class="nx">int64add</span><span class="p">(</span><span class="nx">H</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="nx">H</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="nx">h</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">//represent the hash as an array of 32-bit dwords</span>
  <span class="kd">var</span> <span class="nx">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nx">hash</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">H</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">h</span><span class="p">;</span>
    <span class="nx">hash</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">H</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">l</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">hash</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//A constructor for 64-bit numbers</span>
<span class="kd">function</span> <span class="nx">int64</span><span class="p">(</span><span class="nx">h</span><span class="p">,</span> <span class="nx">l</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="nx">l</span><span class="p">;</span>
  <span class="c1">//this.toString = int64toString;</span>
<span class="p">}</span>

<span class="c1">//Copies src into dst, assuming both are 64-bit numbers</span>
<span class="kd">function</span> <span class="nx">int64copy</span><span class="p">(</span><span class="nx">dst</span><span class="p">,</span> <span class="nx">src</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nx">dst</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>
  <span class="nx">dst</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">l</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//Right-rotates a 64-bit number by shift</span>
<span class="c1">//Won&#39;t handle cases of shift&gt;=32</span>
<span class="c1">//The function revrrot() is for that</span>
<span class="kd">function</span> <span class="nx">int64rrot</span><span class="p">(</span><span class="nx">dst</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">shift</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">dst</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">l</span> <span class="o">&gt;&gt;&gt;</span> <span class="nx">shift</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">h</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">32</span><span class="o">-</span><span class="nx">shift</span><span class="p">));</span>
    <span class="nx">dst</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="nx">shift</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">l</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">32</span><span class="o">-</span><span class="nx">shift</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">//Reverses the dwords of the source and then rotates right by shift.</span>
<span class="c1">//This is equivalent to rotation by 32+shift</span>
<span class="kd">function</span> <span class="nx">int64revrrot</span><span class="p">(</span><span class="nx">dst</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">shift</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">dst</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="nx">shift</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">l</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">32</span><span class="o">-</span><span class="nx">shift</span><span class="p">));</span>
    <span class="nx">dst</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">l</span> <span class="o">&gt;&gt;&gt;</span> <span class="nx">shift</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">h</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">32</span><span class="o">-</span><span class="nx">shift</span><span class="p">));</span>
<span class="p">}</span>

<span class="c1">//Bitwise-shifts right a 64-bit number by shift</span>
<span class="c1">//Won&#39;t handle shift&gt;=32, but it&#39;s never needed in SHA512</span>
<span class="kd">function</span> <span class="nx">int64shr</span><span class="p">(</span><span class="nx">dst</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">shift</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">dst</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">l</span> <span class="o">&gt;&gt;&gt;</span> <span class="nx">shift</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">h</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">32</span><span class="o">-</span><span class="nx">shift</span><span class="p">));</span>
    <span class="nx">dst</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="nx">shift</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//Adds two 64-bit numbers</span>
<span class="c1">//Like the original implementation, does not rely on 32-bit operations</span>
<span class="kd">function</span> <span class="nx">int64add</span><span class="p">(</span><span class="nx">dst</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kd">var</span> <span class="nx">w0</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">);</span>
   <span class="kd">var</span> <span class="nx">w1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">l</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">l</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">w0</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
   <span class="kd">var</span> <span class="nx">w2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">w1</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
   <span class="kd">var</span> <span class="nx">w3</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">w2</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
   <span class="nx">dst</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="nx">w0</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">w1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>
   <span class="nx">dst</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">w2</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">w3</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//Same, except with 4 addends. Works faster than adding them one by one.</span>
<span class="kd">function</span> <span class="nx">int64add4</span><span class="p">(</span><span class="nx">dst</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">d</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kd">var</span> <span class="nx">w0</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">);</span>
   <span class="kd">var</span> <span class="nx">w1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">l</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">l</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">l</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">l</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">w0</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
   <span class="kd">var</span> <span class="nx">w2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">w1</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
   <span class="kd">var</span> <span class="nx">w3</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">w2</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
   <span class="nx">dst</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="nx">w0</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">w1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>
   <span class="nx">dst</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">w2</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">w3</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//Same, except with 5 addends</span>
<span class="kd">function</span> <span class="nx">int64add5</span><span class="p">(</span><span class="nx">dst</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span>
<span class="p">{</span>
   <span class="kd">var</span> <span class="nx">w0</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">l</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">);</span>
   <span class="kd">var</span> <span class="nx">w1</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">l</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">l</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">l</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">l</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">l</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">w0</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
   <span class="kd">var</span> <span class="nx">w2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">h</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">w1</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
   <span class="kd">var</span> <span class="nx">w3</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">w2</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
   <span class="nx">dst</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="nx">w0</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">w1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>
   <span class="nx">dst</span><span class="p">.</span><span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">w2</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">w3</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<table class="hr"><tr><td></td></tr></table><div style="margin-top:0.5em;">&copy; 1998 - 2012
                        <img src="../../logos/email.png" style="border:none" height="16" alt="" width="16"><a href="mailto:paj@pajhome.org.uk">Paul Johnston</a>, distributed under the <a href="../../site/legal.html#bsdlicense">BSD License</a> &nbsp; <b>Updated:</b>10 Jun 2009</div></td></tr></table></body></html>